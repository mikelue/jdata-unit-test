<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.9.2 from src/site/asciidoc/examples.adoc at 2020-06-08
 | Rendered using Apache Maven Fluido Skin 1.7
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20200608" />
    <meta http-equiv="Content-Language" content="en" />
    <title>JDUT:parent &#x2013; </title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.7.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
    <script type="text/javascript" src="./js/apache-maven-fluido-1.7.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/github.min.css" />
			<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js"></script>
			<script>hljs.initHighlightingOnLoad();</script>
			<style>
				code, pre {
					font-family: "DejaVu Sans Mono","Bitstream Vera Sans Mono",Monaco,Menlo,Consolas,"Courier New",monospace;
					font-size: 14px;
				}
			</style>
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><div id="bannerLeft"><h2>JDUT:parent</h2>
</div>
</div>
        <div class="pull-right"></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        <li id="projectVersion">Version: 1.0.0-SNAPSHOT<span class="divider">|</span></li>
      <li class=""><a href="index.html" title="Home">Home</a><span class="divider">/</span></li>
    <li class="active "></li>
        <li id="publishDate" class="pull-right"><span class="divider">|</span> Last Published: 2020-06-08</li>
      <li class="pull-right"><span class="divider">|</span>
<a href="sitemap.html" title="Site Map">Site Map</a></li>
      <li class="pull-right"><a href="scm.html" title="Source Repository">Source Repository</a></li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
    <ul class="nav nav-list">
      <li class="nav-header">Documents</li>
    <li><a href="index.html" title="About"><span class="none"></span>About</a></li>
    <li><a href="guidelines.html" title="Guidelines"><span class="none"></span>Guidelines</a></li>
    <li><a href="integrate-test-frameworks.html" title="Integrate Test Frameworks"><span class="none"></span>Integrate Test Frameworks</a></li>
    <li class="active"><a href="#"><span class="none"></span>Examples</a></li>
    <li><a href="yaml-syntax.html" title="YAML Syntax"><span class="none"></span>YAML Syntax</a></li>
      <li class="nav-header">API References</li>
    <li><a href="apidocs/index.html" title="Javadoc"><span class="none"></span>Javadoc</a></li>
    <li><a href="xref/index.html" title="Source Xref"><span class="none"></span>Source Xref</a></li>
      <li class="nav-header">Project Documentation</li>
    <li><a href="project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a></li>
      <li class="nav-header">Modules</li>
    <li><a href="core/index.html" title="JDUT-core"><span class="none"></span>JDUT-core</a></li>
    <li><a href="testng/index.html" title="JDUT-testng"><span class="none"></span>JDUT-testng</a></li>
    <li><a href="junit4/index.html" title="JDUT-junit4"><span class="none"></span>JDUT-junit4</a></li>
    <li><a href="junit5/index.html" title="JDUT-junit5"><span class="none"></span>JDUT-junit5</a></li>
</ul>
          <hr />
          <div id="poweredBy">
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<h1>Examples</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#database_schema">Database schema</a></li>
<li><a href="#java_api">Java API</a>
<ul class="sectlevel2">
<li><a href="#building_data">Building data</a></li>
<li><a href="#cleaning_data">Cleaning data</a></li>
</ul>
</li>
<li><a href="#yaml_api">YAML API</a>
<ul class="sectlevel2">
<li><a href="#building_data_by_yaml">Building data by YAML</a></li>
<li><a href="#cleaning_data_by_yaml">Cleaning data by YAML</a></li>
<li><a href="#data_definitions">Data definitions</a></li>
</ul>
</li>
<li><a href="#testng">TestNG</a>
<ul class="sectlevel2">
<li><a href="#register_listenertestng">Register listener(TestNG)</a></li>
<li><a href="#use_of_jdutresource">Use of @JdutResource</a></li>
<li><a href="#customize_listener">Customize listener</a></li>
</ul>
</li>
<li><a href="#junit_4">JUnit 4</a>
<ul class="sectlevel2">
<li><a href="#rule">@Rule</a></li>
<li><a href="#classrule">@ClassRule</a></li>
</ul>
</li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This page demonstrates examples from testing code of JDUT.</p>
</div>
<hr/>
</div>
</div>
<div class="sect1">
<h2 id="database_schema"><a class="link" href="#database_schema">Database schema</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="xref-test/guru/mikelue/jdut/example/SchemaSetup.html">Database Schema</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">CREATE TABLE IF NOT EXISTS ex_artist(
	at_id IDENTITY PRIMARY KEY,
	at_name VARCHAR(512) NOT NULL,
	at_gender TINYINT NOT NULL DEFAULT 3,
	at_birthday DATE
);

CREATE TABLE IF NOT EXISTS ex_album(
	ab_id IDENTITY PRIMARY KEY,
	ab_name VARCHAR(512) NOT NULL,
	ab_release_date DATE NOT NULL,
	ab_duration_seconds SMALLINT NOT NULL,
	ab_type TINYINT NOT NULL DEFAULT 1,
	ab_at_id INTEGER NOT NULL
);</code></pre>
</div>
</div>
<hr/>
</div>
</div>
<div class="sect1">
<h2 id="java_api"><a class="link" href="#java_api">Java API</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The file <a href="xref-test/guru/mikelue/jdut/example/JdbcExampleTest.html">JdbcExampleTest.java</a> contains runnable code for examples of using JDUT by pure-Java API.</p>
</div>
<div class="sect2">
<h3 id="building_data"><a class="link" href="#building_data">Building data</a></h3>
<div class="paragraph">
<p>Following code shows how to build data for method of <code>countAlbumsByType</code> in <a href="xref-test/guru/mikelue/jdut/example/JdbcExampleTest.html">JdbcExampleTest.java</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">private DataGrain dataGrain_1ForListing;
private DataGrain dataGrain_2ForListing;

int idOfArtistForListing = 9081;

/**
 * Random data supplier
 */
Supplier&lt;Date&gt; randomDate = JdbcExampleTest::randomDate;
Supplier&lt;Integer&gt; randomDuration = JdbcExampleTest::randomDuration;
// :~)

/**
 * Insertion of data for table "ex_artist"
 */
dataConductor.conduct(
	dataGrain_1ForListing = DataGrain.build(
		builder -&gt; builder.name("ex_artist"),
		rowsBuilder -&gt; rowsBuilder
			.implicitColumns("at_id", "at_name")
			.addValues(idOfArtistForListing, "Sonny Rollins")
	),
	operatorFactory.get(DefaultOperators.INSERT)
);
// :~)
/**
 * Insertion of data for table "ex_album"
 */
dataConductor.conduct(
	dataGrain_2ForListing = DataGrain.build(
		builder -&gt; builder.name("ex_album"),
		rowsBuilder -&gt; rowsBuilder
			.implicitColumns(
				"ab_id", "ab_name", "ab_release_date", "ab_duration_seconds", "ab_type", "ab_at_id"
			)
			.addValues(
				4051, "No. 1", randomDate, randomDuration,
				1,
				idOfArtistForListing
			)
			.addValues(
				4052, "No. 2", randomDate, randomDuration,
				2,
				idOfArtistForListing
			)
			.addValues(
				4053, "No. 3", randomDate, randomDuration,
				3,
				idOfArtistForListing
			)
			.addValues(
				4054, "No. 4", randomDate, randomDuration,
				1,
				idOfArtistForListing
			)
	),
	operatorFactory.get(DefaultOperators.INSERT)
);
// :~)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cleaning_data"><a class="link" href="#cleaning_data">Cleaning data</a></h3>
<div class="paragraph">
<p>Following code shows how to clean data for method of <code>countAlbumsByType</code> in <a href="xref-test/guru/mikelue/jdut/example/JdbcExampleTest.html">JdbcExampleTest.java</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">dataConductor.conduct(
	dataGrain_2ForListing,
	operatorFactory.get(DefaultOperators.DELETE)
);
dataConductor.conduct(
	dataGrain_1ForListing,
	operatorFactory.get(DefaultOperators.DELETE)
);
break;</code></pre>
</div>
</div>
<hr/>
</div>
</div>
</div>
<div class="sect1">
<h2 id="yaml_api"><a class="link" href="#yaml_api">YAML API</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The file <a href="xref-test/guru/mikelue/jdut/example/YamlExampleTest.html">YamlExampleTest.java</a> contains runnable code for examples of using JDUT by YAML.</p>
</div>
<div class="paragraph">
<p>You can find <a href="https://github.com/mikelue/jdata-unit-test/tree/master/core/src/test/resources/guru/mikelue/jdut/example/">YAML files</a> in GitHub.</p>
</div>
<div class="sect2">
<h3 id="building_data_by_yaml"><a class="link" href="#building_data_by_yaml">Building data by YAML</a></h3>
<div class="paragraph">
<p>Following code snippet demonstrates using of <a href="apidocs/guru/mikelue/jdut/DuetConductor.html">DuetConductor</a>`.build` with YAML.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">private static Map&lt;String, DuetConductor&gt; duetConductors = new HashMap&lt;&gt;(6);

@BeforeMethod
private void buildData(Method method)
{
	duetConductors.put(
		method.getName(),
		yamlConductor.conductResource(
			"guru/mikelue/jdut/example/YamlExampleTest-" + method.getName() + ".yaml"
		)
	);

	duetConductors.get(method.getName()).build();
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cleaning_data_by_yaml"><a class="link" href="#cleaning_data_by_yaml">Cleaning data by YAML</a></h3>
<div class="paragraph">
<p>Following code snippet demonstrates using of <a href="apidocs/guru/mikelue/jdut/DuetConductor.html">DuetConductor</a><code>.clean</code> with YAML.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@AfterMethod
private void cleanData(Method method)
{
	duetConductors.get(method.getName()).clean();
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="data_definitions"><a class="link" href="#data_definitions">Data definitions</a></h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">%TAG !jdut! tag:jdut.mikelue.guru:1.0/
%TAG !dbtype! tag:jdut.mikelue.guru:jdbcType:1.8/
%TAG !sql! tag:jdut.mikelue.guru:sql:1.0/

- !sql!table ex_artist : [
	{ at_id: &amp;artist_id 38997, at_name: "Charlie Parker" }
]

- !sql!table ex_album : {
	config: {
		build_operation: "insert_and_log",
		decorator: "decorator_album"
	},

	data: [
		{
			ab_id: 4051, ab_name: "No. 1",
			ab_duration_seconds: !jdut!supplier "random_duration", ab_release_date: !jdut!supplier "random_date",
			ab_type: 1, ab_at_id: *artist_id
		},
		{
			ab_id: 4052, ab_name: "No. 2",
			ab_duration_seconds: !jdut!supplier "random_duration", ab_release_date: !jdut!supplier "random_date",
			ab_type: 1, ab_at_id: *artist_id
		},
		{
			ab_id: 4053, ab_name: "No. 3",
			ab_duration_seconds: !jdut!supplier "random_duration", ab_release_date: !jdut!supplier "random_date",
			ab_type: 2, ab_at_id: *artist_id
		},
		{
			ab_id: 4054, ab_name: "No. 4",
			ab_duration_seconds: !jdut!supplier "random_duration", ab_release_date: !jdut!supplier "random_date",
			ab_type: 3, ab_at_id: *artist_id
		}
	]
}</code></pre>
</div>
</div>
<hr/>
</div>
</div>
</div>
<div class="sect1">
<h2 id="testng"><a class="link" href="#testng">TestNG</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The file <a href="xref-test/guru/mikelue/jdut/testng/example/TestNgExampleTest.html">TestNgExampleTest.java</a> contains runnable code for examples of using JDUT by YAML and build-in listeners of <a href="https://testng.org/">TestNG</a>.</p>
</div>
<div class="paragraph">
<p>You can find <a href="https://github.com/mikelue/jdata-unit-test/tree/master/testng/src/test/resources/guru/mikelue/jdut/testng/example/">YAML files</a> in GitHub.</p>
</div>
<div class="sect2">
<h3 id="register_listenertestng"><a class="link" href="#register_listenertestng">Register listener(TestNG)</a></h3>
<div class="paragraph">
<p>Following code snippet shows the registering listener to <a href="https://testng.org/">TestNG</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Listeners(TestNgExampleTest.ExampleMethodListener.class)
public class TestNgExampleTest extends AbstractDataSourceTestBase {
	/* ... */
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="use_of_jdutresource"><a class="link" href="#use_of_jdutresource">Use of @JdutResource</a></h3>
<div class="paragraph">
<p>Following code snippet demonstrates the usage of <code>@JdutResource</code> on your test methods.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Test @JdutResource
public void countAlbumsByType() throws SQLException
{
	Assert.assertEquals(
		testedDao.countAlbumsByType(1),
		2
	);
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="customize_listener"><a class="link" href="#customize_listener">Customize listener</a></h3>
<div class="paragraph">
<p>Following code snippet demonstrates the listener with customized value supplier, decorator, operator, etc,.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// lhjs:java
public static class ExampleMethodListener extends IInvokedMethodYamlFactoryListener {
	private Logger logger = LoggerFactory.getLogger(ExampleMethodListener.class);

	public ExampleMethodListener() {}

	private YamlConductorFactory yamlFactory = null;

	@Override
	protected YamlConductorFactory buildYamlConductorFactory(IAttributes attributes)
	{
		if (yamlFactory != null) {
			return yamlFactory;
		}

		yamlFactory = YamlConductorFactory.build(
			getDataSource(attributes),
			builder -&gt; builder
				.namedSupplier(
					"random_date", TestNgExampleTest::randomDate
				)
				.namedSupplier(
					"random_duration", TestNgExampleTest::randomDuration
				)
				.namedOperator(
					"insert_and_log",
					(connection, dataGrain) -&gt; {
						logger.info("@@@ BEFORE BUILDING DATA @@@");

						DataGrain result = DefaultOperators.insert(connection, dataGrain);

						logger.info("@@@ AFTER BUILDING DATA @@@");

						return result;
					}
				)
				.namedDecorator(
					"decorator_album",
					(dataRowBuilder) -&gt; {
						dataRowBuilder.fieldOfValue(
							"ab_name",
							dataRowBuilder.getData("ab_name").get() + "(BlueNote)"
						);
					}
				)
		);

		return yamlFactory;
	}
}</code></pre>
</div>
</div>
<hr/>
</div>
</div>
</div>
<div class="sect1">
<h2 id="junit_4"><a class="link" href="#junit_4">JUnit 4</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The module supports JUnit since version of <strong>4.9</strong>.</p>
</div>
<div class="paragraph">
<p>You can find <a href="https://github.com/mikelue/jdata-unit-test/tree/master/junit4/src/test/resources/guru/mikelue/jdut/junit4/">YAML files</a> in GitHub.</p>
</div>
<div class="sect2">
<h3 id="rule"><a class="link" href="#rule">@Rule</a></h3>
<div class="paragraph">
<p>You may use <a href="https://junit.org/junit4/javadoc/latest/org/junit/Rule.html">@Rule</a> to use the conduction of data from YAML file.</p>
</div>
<div class="paragraph">
<p>See full example from <a href="xref-test/guru/mikelue/jdut/junit4/JdutYamlFactoryTest.html">JdutYamlFactoryTest.java</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.junit.Rule;
import org.junit.Test;

import guru.mikelue.jdut.junit4.JdutYamlFactoryTest;
import guru.mikelue.jdut.annotation.JdutResource;

public class JdutYamlFactoryTest extends AbstractDataSourceTestBase {
	@Rule
	public JdutYamlFactory jdutYamlFactoryForMethodLevel = new JdutYamlFactory(conductorFactory);

	@Test @JdutResource
	public void sampleTest()
	{
		/* Your tests... */
	}
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="classrule"><a class="link" href="#classrule">@ClassRule</a></h3>
<div class="paragraph">
<p>You may use <a href="https://junit.org/junit4/javadoc/latest/org/junit/ClassRule.html">@ClassRule</a> to use the conduction of data from YAML file.</p>
</div>
<div class="paragraph">
<p>See full example from <a href="xref-test/guru/mikelue/jdut/junit4/JdutYamlFactoryForClassRuleTest.html">JdutYamlFactoryForClassRuleTest.java</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.junit.Rule;
import org.junit.Test;

import guru.mikelue.jdut.junit4.JdutYamlFactoryTest;
import guru.mikelue.jdut.annotation.JdutResource;

@JdutResource
public class JdutYamlFactoryForClassRuleTest extends AbstractDataSourceTestBase {
	@ClassRule
	public static TestRule rule = new TestRule() {
		@Override
		public Statement apply(Statement base, Description description)
		{
			return new Statement() {
				@Override
				public void evaluate() throws Throwable
				{
					new JdutYamlFactory(getDataSource())
						.apply(base, description)
						.evaluate();
				}
			};
		}
	};

	public JdutYamlFactoryForClassRuleTest() {}

	@Test
	public void sampleTest()
	{
		/* Your tests... */
	}
}</code></pre>
</div>
</div>
</div>
</div>
</div>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &copy;2020.
All rights reserved.</p>
        </div>
      </div>
    </footer>
  </body>
</html>